function removeDomainFromUrl(g){return g.replace(/^https?:\/\/[^\/]+/i,"")}function var_dump(g,l){var k="";l||(l=0);for(var o="",i=0;l+1>i;i++)o+="    ";if("object"==typeof g)for(var m in g)i=g[m],"object"==typeof i?(k+=o+"'"+m+"' ...\n",k+=var_dump(i,l+1)):k+=o+"'"+m+"' => \""+i+'"\n';else k="===>"+g+"<===("+typeof g+")";return k}
var IMG_PARAM={URL:0,TITLE:1,ALT:2,WIDTH:3,HEIGHT:4},pluginPath=removeDomainFromUrl(CKEDITOR.plugins.get("slideshow").path),BASE_PATH=removeDomainFromUrl(CKEDITOR.basePath),SCRIPT_JQUERY=pluginPath+"3rdParty/jquery.min.js",SCRIPT_ADDGAL=pluginPath+"3rdParty/ad-gallery/jquery.ad-gallery.min.js",CSS_ADDGAL=pluginPath+"3rdParty/ad-gallery/jquery.ad-gallery.css",SCRIPT_FANCYBOX=pluginPath+"3rdParty/fancybox2/jquery.fancybox.pack.js?v=2.1.5",CSS_FANCYBOX=pluginPath+"3rdParty/fancybox2/jquery.fancybox.css?v=2.1.5",
listItem=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.is("li")},ULItem=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.is("ul")},iFrameItem=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.is("iframe")};Array.prototype.pushUnique=function(g){for(var l=0;l<this.length;l++)if(this[l][0]==g[0])return-1;return this.push(g),this.length-1};Array.prototype.updateVal=function(g,l){for(var k=0;k<this.length;k++)if(this[k][0]==g)return this[k]=[g,l],!0;return this[k]=[g,l],!1};
Array.prototype.getVal=function(g){for(var l=0;l<this.length;l++)if(this[l][0]==g)return this[l][1];return null};
CKEDITOR.dialog.add("slideshowDialog",function(g){function l(a,b,c,d,e){var a=i(a),f;return f=d?d.createElement("OPTION"):document.createElement("OPTION"),a&&f&&"option"==f.getName()?(CKEDITOR.env.ie?(isNaN(parseInt(e,10))?a.$.options.add(f.$):a.$.options.add(f.$,e),f.$.innerHTML=0<b.length?b:"",f.$.value=c):(null!==e&&e<a.getChildCount()?a.getChild(0>e?0:e).insertBeforeMe(f):a.append(f),f.setText(0<b.length?b:""),f.setValue(c)),f):!1}function k(a){return a=i(a),a?a.$.selectedIndex:-1}function o(a,
b){if(a=i(a),0>b)return null;var c=a.getChildren().count();return a.$.selectedIndex=b>=c?c-1:b,a}function i(a){return a&&a.domId&&a.getInputElement().$?a.getInputElement():a&&a.$?a:!1}function m(a){1!=a.openCloseStep&&(a.getContentElement("slideshowinfoid","framepreviewid").isVisible()?t(a):q(a))}function r(a){a=a.getContentElement("slideshowinfoid","imglistitemsid");return k(a)}function q(a){var b=a.getContentElement("slideshowinfoid","imglistitemsid"),b=k(b),c=a.imagesList[b],b=a.getContentElement("slideshowinfoid",
"imgtitleid"),b=i(b);b.setValue(c[1]);b=a.getContentElement("slideshowinfoid","imgdescid");b=i(b);b.setValue(c[2]);b=a.getContentElement("slideshowinfoid","imgpreviewid");b=i(b);b.setHtml('<div style="text-align:center;"> <img src="'+c[0]+'" title="'+c[1]+'" alt="'+c[2]+'" style=" max-height: 200px;  max-width: 350px;"> </div>');b=a.getContentElement("slideshowinfoid","framepreviewid");a=a.getContentElement("slideshowinfoid","imgparamsid");b=i(b);b.hide();a=i(a);a.show()}function u(a,b){var c=a.getContentElement("slideshowinfoid",
"imglistitemsid"),c=i(c),d=k(c);if(1!=c.getChildren().count()&&(-1!=b||0!=d))if(1!=b||d!=c.getChildren().count()-1){var e=c,f=a.getParentEditor().document,e=i(e),c=k(e);if(!(0>c)&&(d=c+b,!(d=0>d?0:d,d=d>=e.getChildCount()?e.getChildCount()-1:d,c==d))){var g=/(^IMG_\d+)/,h=e.getChild(d),j=h.getText(),m=h.getValue(),j=j.replace(g,"IMG_"+c);var n,h=d;if(!(n=i(e),0>h))h=n.getChild(h),h.setText(j),h.setValue(m);h=e.getChild(c);j=h.getText();m=h.getValue();h.remove();j=j.replace(g,"IMG_"+d);l(e,j,m,f?f:
null,d);o(e,d);e=a.imagesList[c];a.imagesList[c]=a.imagesList[d];a.imagesList[d]=e}v(a)}}function t(a){var b=a.getContentElement("slideshowinfoid","framepreviewid"),c=a.getContentElement("slideshowinfoid","imgparamsid"),c=i(c);c.hide();b=i(b);b.show();v(a)}function v(a){var b=300;if(1==a.params.getVal("showthumbid")?b-=120:1==a.params.getVal("showcontrolid")&&(b-=30),0!=a.imagesList.length){var c=a.getContentElement("slideshowinfoid","imglistitemsid"),d=k(c);0>d&&(d=0);var c=a.getContentElement("slideshowinfoid",
"framepreviewid"),e="",e=e+"<head>",e=e+('<script src="'+SCRIPT_JQUERY+'" type="text/javascript"><\/script>'),e=e+('<script type="text/javascript" src="'+SCRIPT_ADDGAL+'"><\/script>'),e=e+('<link rel="stylesheet" type="text/css" href="'+CSS_ADDGAL+'" />');1==a.params.getVal("openOnClickId")&&(e+='<link rel="stylesheet" type="text/css" href="'+CSS_FANCYBOX+'" />',e+='<script type="text/javascript" src="'+SCRIPT_FANCYBOX+'"><\/script>',e+='<script type="text/javascript">',e+=w(a),e+="<\/script>");e+=
'<script type="text/javascript">';e+=x(a,d,436,b);e+="<\/script>";e+="</head>";e+="<body>";d=y(a);e+=d.getOuterHtml();e+="</body>";e+="";c=i(c);(d=c.getFirst(iFrameItem))&&d.remove();var f=null;1==a.params.getVal("showthumbid")?b+=120:1==a.params.getVal("showcontrolid")&&(b+=30);a=CKEDITOR.dom.element.createFromHtml('<iframe style="width:496px;height:'+b+'px;background:azure; " class="cke_pasteframe" frameborder="10"  allowTransparency="false" role="region" scrolling="no"></iframe>');a.setAttribute("name",
"totoFrame");a.setAttribute("id","totoFrame");a.on("load",function(){if(null==f)if(f=this.$,f.contentDocument?iframedoc=f.contentDocument:f.contentWindow&&(iframedoc=f.contentWindow.document),iframedoc){var a=iframedoc,b=e;a.open();a.writeln(b);a.close()}else alert("Cannot inject dynamic contents into iframe.")});c.append(a)}}function n(){var a=this.getDialog();if(a.newSlideShowMode)a.slideshowDOM.setAttribute("data-"+this.id,this.getValue());else switch(this.type){case "checkbox":this.setValue("true"==
a.slideshowDOM.getAttribute("data-"+this.id));break;case "text":this.setValue(a.slideshowDOM.getAttribute("data-"+this.id));break;case "select":this.setValue(a.slideshowDOM.getAttribute("data-"+this.id))}}function j(){var a=this.getDialog();a.params.updateVal(this.id,this.getValue());m(a)}function z(a){a.previewImage&&(a.previewImage.removeListener("load",s),a.previewImage.removeListener("error",p),a.previewImage.removeListener("abort",p),a.previewImage.remove(),a.previewImage=null);a.imagesList=
null;a.params=null;a.slideshowDOM=null;for(var b=combo=a.getContentElement("slideshowinfoid","imglistitemsid"),b=i(b);b.getChild(0)&&b.getChild(0).remove(););a.openCloseStep=!1}function A(a){for(var b="";b.length<a;)b+=Math.random().toString(36).substring(2);return b.substring(0,a)}function x(a,b,c,d){var e="ad-gallery_"+a.params.getVal("slideshowid"),f,g="";f="(function($) {$(function() {";0==d&&(d=a.params.getVal("pictheightid"));0==c&&(c="false");0==a.params.getVal("showtitleid")&&(g=",  hooks: { displayDescription: function(image) {}}");
b="loader_image: '"+pluginPath+"3rdParty/ad-gallery/loader.gif', width:"+c+", height:"+d+", start_at_index: "+b+", animation_speed: "+a.params.getVal("animspeedid")+g+", update_window_hash: false, effect: '"+a.params.getVal("transitiontypeid")+"',";a=" slideshow: { enable: true, autostart: "+a.params.getVal("autostartid")+", start_label: '"+h.labelStart+"', stop_label: '"+h.labelStop+"', speed: "+1E3*a.params.getVal("speedid")+",},";return f+="   var galleries = $('#"+e+"').adGallery({"+b+a+"});",
f+="});",f+"})(jQuery);"}function w(a){var a="ad-gallery_"+a.params.getVal("slideshowid"),b="(function($) {";return b+="$(function() {",b+='$("#'+a+'").on("click",".ad-image",function(){',b+='var imgObj =$(this).find("img");',b+='var isrc=imgObj.attr("src");',b+="var ititle=null;",b+="var idesc=null;",b+="var iname=isrc.split('/');",b+="iname=iname[iname.length-1];",b+='var imgdescid=$(this).find(".ad-image-description");',b+="if(imgdescid){",b+='ititle=$(this).find(".ad-description-title");',b+=
"if(ititle)ititle=ititle.text();",b+="if(ititle!='')ititle='<big>'+ititle+'</big>';",b+='idesc=$(this).find("span");',b+="if(idesc)idesc=idesc.text();",b+="if(idesc!=''){",b+="if(ititle!='')ititle=ititle+'<br>';",b+="idesc='<i>'+idesc+'</i>';",b+="}",b+="}",b+="$.fancybox.open({",b+="href:isrc,",b+="beforeLoad:function(){",b+="this.title=ititle+idesc;",b+="},",b+="});",b+="});",b+="});",b+"})(jQuery);"}function y(a){var b=a.params.getVal("slideshowid"),c="ad-gallery_"+b,d="display: block;",e="display: block;";
0==a.params.getVal("showthumbid")&&(d="display: none;");0==a.params.getVal("showcontrolid")&&(e="visibility: hidden;");var f=g.document.createElement("div");f.setAttribute("id",b);f.setAttribute("class","slideshowPlugin");f.setAttribute("contenteditable","false");b=f.append("div");b.setAttribute("class","ad-gallery");b.setAttribute("contenteditable","false");b.setAttribute("id",c);c=b.append("div");c.setAttribute("class","ad-image-wrapper");c.setAttribute("contenteditable","false");c=b.append("div");
c.setAttribute("class","ad-controls");c.setAttribute("contenteditable","false");c.setAttribute("style",e);e=b.append("div");e.setAttribute("class","ad-nav");e.setAttribute("style",d);e.setAttribute("contenteditable","false");d=e.append("div");d.setAttribute("class","ad-thumbs");d.setAttribute("contenteditable","false");d=d.append("ul");d.setAttribute("class","ad-thumb-list");d.setAttribute("contenteditable","false");for(e=0;e<a.imagesList.length;e++)b=d.append("li"),b.setAttribute("contenteditable",
"false"),aObj=b.append("a"),aObj.setAttribute("href",removeDomainFromUrl(a.imagesList[e][IMG_PARAM.URL])),aObj.setAttribute("contenteditable","false"),newImgDOM=aObj.append("img"),newImgDOM.setAttribute("src",removeDomainFromUrl(a.imagesList[e][IMG_PARAM.URL])),newImgDOM.setAttribute("title",a.imagesList[e][IMG_PARAM.TITLE]),newImgDOM.setAttribute("alt",a.imagesList[e][IMG_PARAM.ALT]),newImgDOM.setAttribute("contenteditable","false"),newImgDOM.setAttribute("width",a.imagesList[e][IMG_PARAM.WIDTH]),
newImgDOM.setAttribute("height",a.imagesList[e][IMG_PARAM.HEIGHT]);return f}var h=g.lang.slideshow,s=function(){var a=this.previewImage;a.removeListener("load",s);a.removeListener("error",p);a.removeListener("abort",p);a=BASE_PATH+"plugins/slideshow/icons/placeholder.png";1==this.imagesList.length&&this.imagesList[0][IMG_PARAM.URL]==a&&(a=this.getContentElement("slideshowinfoid","imglistitemsid"),a=i(a),this.imagesList.splice(0,1),a.getChild(0).remove());var b=this.previewImage,a=b.$.src,b=b.$.width/
b.$.height,c=50,d=50;1<b?d/=b:c*=b;b=this.imagesList.pushUnique([a,"","",c.toFixed(0),d.toFixed(0)]);0<=b&&(oOption=l(combo,"IMG_"+b+" : "+a.substring(a.lastIndexOf("/")+1),a,this.getParentEditor().document),o(combo,b),m(this))},p=function(){var a=this.previewImage;a.removeListener("load",s);a.removeListener("error",p);a.removeListener("abort",p)};return{title:h.dialogTitle,width:500,height:600,resizable:CKEDITOR.DIALOG_RESIZE_NONE,buttons:[CKEDITOR.dialog.okButton(g,{label:"OkCK",style:"display:none;"}),
CKEDITOR.dialog.cancelButton,{id:"myokbtnid",type:"button",label:"OK",title:"Button description",style:"color:white;background:blue;",accessKey:"C",disabled:!1,onClick:function(){var a=this.getDialog(),b={};a.openCloseStep=!0;a.commitContent(a);for(var c=y(a),d=0;d<a.params.length;d++)c.data(a.params[d][0],a.params[d][1]);d=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_ADDGAL}});if(c.append(d),1==a.params.getVal("openOnClickId"))d=CKEDITOR.document.createElement("script",
{attributes:{type:"text/javascript"}}),d.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+CSS_FANCYBOX+'" type="text/css" />\'); })(jQuery);'),c.append(d),d=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_FANCYBOX}}),c.append(d),d=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}}),d.setText(w(a)),c.append(d);d=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});d.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+
CSS_ADDGAL+'" type="text/css" />\'); })(jQuery);');c.append(d);d=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});d.setText(x(a,0,0,0));c.append(d);a.imagesList.length&&(b.backgroundImage='url("'+a.imagesList[0][IMG_PARAM.URL]+'")');b.backgroundSize="50%";b.display="block";c=g.createFakeElement(c,"cke_slideShow","slideShow",!1);c.setAttributes({});c.setStyles(b);a.fakeImage?(c.replace(a.fakeImage),g.getSelection().selectElement(c)):g.insertElement(c);z(a);a.hide()}}],
contents:[{id:"slideshowinfoid",label:"Basic Settings",align:"center",elements:[{type:"text",id:"id",style:"display:none;",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)}},{type:"text",id:"txturlid",style:"display:none;",label:h.imgList,onChange:function(){var a=this.getDialog(),b=this.getValue();if(0<b.length){var c=a.previewImage;c.on("load",s,a);c.on("error",p,a);c.on("abort",p,a);c.setAttribute("src",b)}}},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;margin-top:0px;",
filebrowser:{action:"Browse",target:"slideshowinfoid:txturlid",url:g.config.filebrowserImageBrowseUrl||g.config.filebrowserBrowseUrl},label:h.imgAdd},{type:"vbox",align:"center",children:[{type:"html",align:"center",id:"framepreviewtitleid",style:"font-family: Amaranth; color: #1E66EB;\tfont-size: 20px; font-weight: bold;",html:"Preview"},{type:"html",id:"framepreviewid",align:"center",style:"width:500px;height:320px",html:""},{type:"hbox",id:"imgparamsid",style:"display:none;width:500px;",height:"325px",
children:[{type:"vbox",align:"center",width:"400px",children:[{type:"text",id:"imgtitleid",label:h.imgTitle,onChange:function(){var a=this.getDialog(),b=this.getValue();a.imagesList[r(a)][IMG_PARAM.TITLE]=b;q(a)},onBlur:function(){var a=this.getDialog(),b=this.getValue();a.imagesList[r(a)][IMG_PARAM.TITLE]=b;q(a)}},{type:"text",id:"imgdescid",label:h.imgDesc,onChange:function(){var a=this.getDialog(),b=this.getValue();a.imagesList[r(a)][IMG_PARAM.ALT]=b;q(a)},onBlur:function(){var a=this.getDialog(),
b=this.getValue();a.imagesList[r(a)][IMG_PARAM.ALT]=b;q(a)}},{type:"html",id:"imgpreviewid",style:"width:400px;height:200px;",html:"<div>xx</div>"}]}]},{type:"hbox",align:"center",height:110,widths:["25%","50%"],children:[{type:"vbox",children:[{type:"checkbox",id:"autostartid",label:h.autoStart,"default":"checked",style:"margin-top:15px;",onChange:j,commit:j,setup:n},{type:"checkbox",id:"showtitleid",label:h.showTitle,"default":"checked",onChange:j,commit:j,setup:n},{type:"checkbox",id:"showcontrolid",
label:h.showControls,"default":"checked",onChange:j,commit:j,setup:n},{type:"checkbox",id:"showthumbid",label:h.showThumbs,"default":"checked",onChange:j,commit:j,setup:n},{type:"checkbox",id:"openOnClickId",label:h.openOnClick,"default":"checked",onChange:j,commit:j,setup:n}]},{type:"select",id:"imglistitemsid",label:h.picturesList,multiple:!1,style:"height:125px;width:250px",items:[],onChange:function(){for(var a=this,b=a.getDialog(),a=i(a),c=0,d=0;d<a.getChildren().count();d++){var e=a.getChild(d);
if(e.$.selected){selectefItem=e;c=d;break}}o(a,c);m(b)}},{type:"vbox",children:[{type:"button",id:"previewbtn",style:"margin-top:15px;margin-left:25px;",label:h.previewMode,onClick:function(){t(this.getDialog())}},{type:"button",id:"removeselectedbtn",style:"margin-left:25px;",label:h.imgDelete,onClick:function(){for(var a=this.getDialog(),b=a.getContentElement("slideshowinfoid","imglistitemsid"),b=i(b),c=!1,d=b.getChildren().count()-1;0<=d;d--)b.getChild(d).$.selected&&(a.imagesList.splice(d,1),
b.getChild(d).remove(),c=!0);c&&(0==a.imagesList.length&&(c=BASE_PATH+"plugins/slideshow/icons/placeholder.png",oOption=l(b,"IMG_0 : "+c.substring(c.lastIndexOf("/")+1),c,a.getParentEditor().document),a.imagesList.pushUnique([c,h.imgTitle,h.imgDesc,"50","50"])),o(b,0),m(a))}},{type:"button",id:"editselectedbtn",style:"margin-left:25px;",label:h.imgEdit,onClick:function(){q(this.getDialog())}},{type:"hbox",children:[{type:"button",id:"upselectedbtn",style:"width:32px; margin-left:25px;",label:"↑",
onClick:function(){u(this.getDialog(),-1)}},{type:"button",id:"downselectedbtn",style:"width:32px;",label:"↓",onClick:function(){u(this.getDialog(),1)}}]}]}]},{type:"hbox",children:[{type:"text",id:"pictheightid",label:h.pictHeight,maxLength:3,style:"width:100px;","default":"300",onChange:function(){0==/^\d+$/.test(this.getValue())&&this.setValue(300);this.getDialog().params.updateVal(this.id,this.getValue());m(this.getDialog())},commit:j,setup:n},{type:"text",id:"speedid",label:h.displayTime,maxLength:3,
style:"width:100px;","default":"5",onChange:function(){0==/^\d+$/.test(this.getValue())&&this.setValue(5);this.getDialog().params.updateVal(this.id,this.getValue());m(this.getDialog())},commit:j,setup:n},{type:"text",id:"animspeedid",label:h.transitionTime,style:"width:100px;",maxLength:4,"default":"500",onChange:function(){0==/^\d+$/.test(this.getValue())&&this.setValue(500);this.getDialog().params.updateVal(this.id,this.getValue());m(this.getDialog())},commit:j,setup:n},{type:"select",id:"transitiontypeid",
label:h.transition,items:[[h.tr1,"none"],[h.tr2,"resize"],[h.tr3,"slide-vert"],[h.tr4,"slide-hori"],[h.tr5,"fade"]],"default":"resize",style:"width:100px;",commit:j,setup:n,onChange:j}]}]}]}],onLoad:function(){},onShow:function(){this.dialog=this;this.slideshowDOM=null;this.openCloseStep=!0;var a=this.fakeImage=null;this.imagesList=[];this.params=[];this.previewImage=g.document.createElement("img");this.okRefresh=!0;var b=this.getSelectedElement();if(b&&b.data("cke-real-element-type")&&"slideShow"==
b.data("cke-real-element-type")&&(this.fakeImage=b,a=g.restoreRealElement(b)),a){this.slideshowDOM=a;b=a.getElementsByTag("ul");b=null==b?null:1==b.count()?b.getItem(0):null;if(null==b)return alert("BIG Problem slideShowContainer !!"),!1;var c=a.getAttribute("id");if(null==c)return alert("BIG Problem slideshowid !!"),!1;this.params.push(["slideshowid",c]);var d,e,f,i=b.$.getElementsByTagName("img");combo=this.getContentElement("slideshowinfoid","imglistitemsid");for(b=0;b<i.length;b++){d=i[b];c=d.src;
e=d.width;0==e&&(e=d.naturalWidth);0==e?(e=50,f=50):(f=d.height,0==f&&(f=d.naturalHeight),0==f&&(e=50,f=50));e/=f;var j=50,k=50;1<e?k/=e:j*=e;d=this.imagesList.pushUnique([c,d.title,d.alt,j,k]);0<=d&&(oOption=l(combo,"IMG_"+d+" : "+c.substring(c.lastIndexOf("/")+1),c,this.getParentEditor().document))}o(combo,0);m(this);a=a.$.dataset;for(param in a)this.params.push([param,a[param]]);this.setupContent(this,!0);this.newSlideShowMode=!1}else this.params.push(["slideshowid","cke_"+A(8)+"_slideShow"]),
combo=this.getContentElement("slideshowinfoid","imglistitemsid"),a=BASE_PATH+"plugins/slideshow/icons/placeholder.png",oOption=l(combo,"IMG_0 : "+a.substring(a.lastIndexOf("/")+1),a,this.getParentEditor().document),this.imagesList.pushUnique([a,h.imgTitle,h.imgDesc,"50","50"]),o(combo,0),m(this),this.commitContent(this);this.openCloseStep=!1;t(this)},onOk:function(){return!1},onHide:function(){z(this)}}});